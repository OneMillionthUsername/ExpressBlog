<% 
    pageTitle = 'Meistgelesene Posts - Sub specie aeternitatis';
    metaDescription = 'Die meistgelesenen Beiträge dieses Blogs, sortiert nach Aufrufen.';
%>
<div class="container-fluid header-section">
    <h1 class="main-title">Meistgelesene Posts</h1>
    <p class="description">Die beliebtesten Beiträge nach Aufrufen sortiert</p>
    <hr class="header-divider">
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="content-area">
                <% if (typeof errorMessage !== 'undefined' && errorMessage) { %>
                    <p class="text-muted small"><%= errorMessage %></p>
                <% } %>
                <div id="mostReadPosts">
                    <% 
                      const stripHtml = (s) => String(s || '').replace(/<[^>]*>/g, '');
                      const createExcerpt = (htmlContent, maxLen = 150) => {
                        const txt = stripHtml(htmlContent).trim();
                        if (!txt) return '';
                        return txt.length > maxLen ? txt.substring(0, maxLen) + '...' : txt;
                      };
                    %>
                    <% if (typeof posts !== 'undefined' && Array.isArray(posts) && posts.length > 0) { %>
                        <% posts.forEach(function(post, idx) { %>
                            <div class="most-read-item">
                                <span class="rank">#<%= idx + 1 %></span>
                                <div class="most-read-content">
                                    <h3><a class="post-link-style" href="/blogpost/<%= post.slug || ('by-id/' + post.id) %>"><%= post.title %></a></h3>
                                    <p><%= (post.views || 0) %> views | <%= new Date(post.created_at).toLocaleDateString('de-DE') %></p>
                                    <p class="post-excerpt"><%= createExcerpt(post.content, 150) %></p>
                                </div>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <p>Lade Statistiken...</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    <div class="navigation text-center mt-4">
        <a href="/" class="btn btn-outline-primary">Zur Startseite</a>
        <a href="/posts" class="btn btn-outline-secondary ml-2">Alle Posts</a>
    </div>
</div>
