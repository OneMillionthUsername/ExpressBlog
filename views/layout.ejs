<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">

    <%# Theme-Script: muss blockierend sein um FOUC zu vermeiden - das ist OK %>
    <script<% if (typeof nonce !== 'undefined') { %> nonce="<%= String(nonce) %>"<% } %>>
        (function(){
            try {
                var saved = localStorage.getItem('blog-theme');
                var dark = saved ? (saved === 'dark') : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
                if (dark) document.documentElement.setAttribute('data-theme','dark');
            } catch(e) { /* no-op */ }
        })();
    </script>

    <%# Google Fonts: preconnect + non-blocking load via print/onload trick %>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap"
          onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap">
    </noscript>

    <%# Bootstrap lokal - kein externes CDN %>
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">

    <%# Font Awesome nur wenn die Seite es braucht %>
    <% if (typeof useFontAwesome !== 'undefined' && useFontAwesome) { %>
    <link rel="stylesheet" href="/assets/css/fontawesome.min.css">
    <% } %>

    <%# TinyMCE CSS nur wenn nötig %>
    <% if (typeof useTinyMce !== 'undefined' && useTinyMce) { %>
    <link rel="stylesheet" href="/assets/css/tinymce-content.css">
    <% } %>

    <%# Eigene CSS-Dateien - alle zusammengeführt in main.css %>
    <link rel="stylesheet" href="/assets/css/main.css?v=<%= typeof assetVersion !== 'undefined' ? assetVersion : '' %>">

    <title><%= typeof pageTitle !== 'undefined' ? pageTitle : 'Sub specie aeternitatis' %></title>

    <% if (typeof metaDescription !== 'undefined' && metaDescription) { %>
    <meta name="description" content="<%= metaDescription %>">
    <% } %>

    <% if (typeof metaRobots !== 'undefined' && metaRobots) { %>
    <meta name="robots" content="<%= metaRobots %>">
    <% } %>

    <% if (typeof extraHead !== 'undefined' && extraHead) { %>
    <%- extraHead %>
    <% } %>
</head>
<body>
    <%- include('partials/navbar.ejs') %>

    <%- body %>

    <footer class="site-footer mt-5">
        <div class="container text-center py-4">
            <span class="footer-title">Sub specie aeternitatis</span>
            <p class="footer-text mb-2">© 2025 BitQuake Digital &nbsp;|&nbsp; Philosophie, Wissenschaft & KI</p>
            <div class="footer-links">
                <a href="/about">Kontakt</a> &nbsp;|&nbsp;
                <a href="/posts">Blogposts</a> &nbsp;|&nbsp;
                <a href="/blogpost/archive">Archiv</a> &nbsp;|&nbsp;
                <a href="/impressum">Impressum</a> &nbsp;|&nbsp;
                <a href="/datenschutz">Datenschutz</a>
            </div>
        </div>
    </footer>

    <%# jQuery + Popper + Bootstrap JS - lokal %>
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/popper.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>

    <script src="/vendor/dompurify.min.js"></script>

    <% if (typeof useTinyMce !== 'undefined' && useTinyMce && typeof tinyMceKey !== 'undefined' && tinyMceKey) { %>
    <script src="https://cdn.tiny.cloud/1/<%= tinyMceKey %>/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <% } %>

    <script src="/assets/js/page-initializers.js" type="module"></script>

    <% if (typeof extraScripts !== 'undefined' && extraScripts) { %>
    <%- extraScripts %>
    <% } %>
</body>
</html>
