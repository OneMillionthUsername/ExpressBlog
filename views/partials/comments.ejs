<!-- Comments partial: renders comment form and list for a post. Expects `post` to be defined -->
<section id="comments-section" class="comments-section">
    <div class="comments-divider">
        <hr>
    </div>

    <h3 id="comments-title" class="comments-title">
        ğŸ’¬ Kommentare <span class="badge badge-secondary" id="comment-count"><%= typeof commentCount !== 'undefined' ? commentCount : 0 %></span>
    </h3>

    <% if (typeof commentMessage !== 'undefined' && commentMessage) { %>
        <div class="alert <%= commentStatus === 'ok' ? 'alert-success' : 'alert-danger' %>">
            <%= commentMessage %>
        </div>
    <% } %>

    <!-- Kommentar-Formular -->
    <div class="comment-form-container">
        <h4 class="mb-3">Kommentar schreiben</h4>
        <form id="comment-form" class="comment-form" method="POST" action="/comments/<%= post.id %>">
            <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <% } %>
            <div class="form-group">
                <label for="comment-username">Name (optional):</label>
                <input type="text" 
                       id="comment-username" 
                       name="username"
                       class="form-control" 
                       placeholder="Dein Name oder lasse es leer fÃ¼r 'Anonym'"
                       maxlength="50">
                <small class="form-text text-muted">
                    Falls leer gelassen, wird "Anonym" angezeigt.
                </small>
            </div>
            
            <div class="form-group">
                <label for="comment-text">Kommentar: <span class="text-danger">*</span></label>
                <textarea id="comment-text" 
                          name="text"
                          class="form-control" 
                          rows="4" 
                          placeholder="Teile deine Gedanken zu diesem Blogpost..."
                          maxlength="1000"
                          required></textarea>
                <div class="d-flex justify-content-between align-items-center mt-1">
                    <small class="form-text text-muted">
                        Sei respektvoll und konstruktiv in deinen Kommentaren.
                    </small>
                    <small id="char-counter" class="char-counter text-muted">0/1000</small>
                </div>
            </div>
            
            <button type="submit" class="btn btn-secondary-theme">
                âœ‰ï¸ Kommentar senden
            </button>
        </form>
    </div>
    
    <!-- Kommentare anzeigen -->
    <div class="comments-list-container">
        <h4 class="mb-3">ğŸ’­ Diskussion</h4>
        <div id="comments-list" class="comments-list">
            <% if (typeof comments !== 'undefined' && Array.isArray(comments) && comments.length > 0) { %>
                <% comments.forEach(function(comment) { %>
                    <div class="comment-item" data-comment-id="<%= comment.id %>">
                        <div class="comment-header">
                            <span class="comment-username">
                                ğŸ‘¤ <%= comment.username || 'Anonym' %>
                            </span>
                            <span class="comment-time"><%= new Date(comment.created_at || comment.createdAt || Date.now()).toLocaleDateString('de-DE') %></span>
                            <% if (typeof isAdmin !== 'undefined' && isAdmin) { %>
                                <form method="POST" action="/comments/<%= post.id %>/<%= comment.id %>/delete" class="d-inline">
                                    <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
                                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                    <% } %>
                                    <button type="submit" class="btn btn-sm btn-outline-danger comment-delete-btn" title="Kommentar lÃ¶schen">
                                        ğŸ—‘ï¸
                                    </button>
                                </form>
                            <% } %>
                        </div>
                        <div class="comment-text"><%- comment.text || '' %></div>
                    </div>
                <% }); %>
            <% } else { %>
                <div class="no-comments">
                    <p class="text-muted text-center">
                        <em>ğŸ’­ Noch keine Kommentare vorhanden. Sei der erste, der kommentiert!</em>
                    </p>
                </div>
            <% } %>
        </div>
    </div>
</section>
